<?xml version='1.0' encoding='windows-1252'?>
<Wix xmlns='http://schemas.microsoft.com/wix/2006/wi'
     xmlns:util='http://schemas.microsoft.com/wix/UtilExtension'>

    <?if $(sys.BUILDARCH) = x64 or $(sys.BUILDARCH) = arm64 ?>
        <?define PlatformProgramFilesFolder = "ProgramFiles64Folder" ?>
    <?else ?>
        <?define PlatformProgramFilesFolder = "ProgramFilesFolder" ?>
    <?endif ?>

    <Product
        Id='*'
        Name='Calculadora Gestacional'
        UpgradeCode='65F58F8A-2B21-4FB5-89D7-C7A189B21B66'
        Manufacturer='Paulo A V Munhoz'
        Language='1046'
        Codepage='1252'
        Version='$(var.Version)'>

        <Package Id='*'
            Keywords='Instalador'
            Manufacturer='Paulo A V Munhoz'
            InstallerVersion='450'
            Languages='1046'
            Compressed='yes'
            InstallScope='perMachine'
            SummaryCodepage='1252'
            />

        <MajorUpgrade
            Schedule='afterInstallInitialize'
            DowngradeErrorMessage='Uma versão mais recente de [ProductName] já está instalada.'/>

        <Media Id='1' Cabinet='media1.cab' EmbedCab='yes' DiskPrompt='CD-ROM #1'/>
        <Property Id='DiskPrompt' Value='Instalação da Calculadora Gestacional'/>

        <Directory Id='TARGETDIR' Name='SourceDir'>
            <Directory Id='$(var.PlatformProgramFilesFolder)' Name='PFiles'>
                <Directory Id='APPLICATIONFOLDER' Name='Calculadora Gestacional'>
                    <Directory Id='Bin' Name='bin'>
                        <Component Id='binary0' Guid='*'>
                            <File
                                Id='exe0'
                                Name='calculadora_gestacional.exe'
                                DiskId='1'
                                Source='$(var.CargoTargetBinDir)\calculadora_gestacional.exe'
                                KeyPath='yes'/>
                        </Component>
                    </Directory>
                </Directory>
            </Directory>
            
            <Directory Id="ProgramMenuFolder">
                <Directory Id="ApplicationProgramsFolder" Name="Calculadora Gestacional"/>
            </Directory>
            
            <Directory Id="DesktopFolder" Name="Desktop" />
        </Directory>

        <DirectoryRef Id="ApplicationProgramsFolder">
            <Component Id="ApplicationShortcut" Guid="*">
                <Shortcut Id="ApplicationStartMenuShortcut"
                    Name="Calculadora Gestacional"
                    Description="Calculadora de Idade Gestacional do Bebê"
                    Target="[#exe0]"
                    WorkingDirectory="APPLICATIONFOLDER"/>
                <Shortcut Id="ApplicationDesktopShortcut"
                          Name="Calculadora Gestacional"
                          Description="Calculadora de Idade Gestacional do Bebê"
                          Target="[#exe0]"
                          Directory="DesktopFolder"/>
                <RemoveFolder Id="ApplicationProgramsFolder" On="uninstall"/>
                <RegistryValue Root="HKCU" Key="Software\Paulo A V Munhoz\CalculadoraGestacional" Name="installed" Type="integer" Value="1" KeyPath="yes"/>
            </Component>
        </DirectoryRef>
        
        <Feature
            Id='Binaries'
            Title='Aplicação Principal'
            Description='Instala todos os arquivos necessários.'
            Level='1'
            ConfigurableDirectory='APPLICATIONFOLDER'
            AllowAdvertise='no'
            Display='expand'
            Absent='disallow'>
            
            <ComponentRef Id='binary0'/>
            <ComponentRef Id="ApplicationShortcut" />
        </Feature>

        <SetProperty Id='ARPINSTALLLOCATION' Value='[APPLICATIONFOLDER]' After='CostFinalize'/>
        
        <Icon Id="ProductIcon" SourceFile="wix\Product.ico"/>
        <Property Id="ARPPRODUCTICON" Value="ProductIcon" />

        <Property Id="WIXUI_INSTALLDIR" Value="APPLICATIONFOLDER" />
        
        <!-- <WixVariable Id="WixUILicenseRtf" Value="wix\Eula.rtf" />  -->

        <!-- INÍCIO DA ALTERAÇÃO FINAL: Define o fluxo de telas da UI -->
        <UI>
            <UIRef Id="WixUI_InstallDir" />
            
            <!-- Define que o botão "Avançar" da tela de boas-vindas leva para a tela de licença -->
            <Publish Dialog="WelcomeDlg" Control="Next" Event="NewDialog" Value="LicenseAgreementDlg">1</Publish> 
            
            <!-- Define que o botão "Voltar" da tela de licença leva de volta para a tela de boas-vindas -->
            <Publish Dialog="LicenseAgreementDlg" Control="Back" Event="NewDialog" Value="WelcomeDlg">1</Publish> 
        </UI>
        <!-- FIM DA ALTERAÇÃO FINAL -->

    </Product>
</Wix>
